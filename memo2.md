# frontendの役割

    - UIをつかさどる
    - 基本的な動きはgameStateをなんでもbackendで変更して変更後のデータを、Socketで受け取る。
    - Socketでデータを受け取ったことはuseEffectで検知して、gameStateの更新のたびに再レンダリングをする。

# backendの役割

    -   backendの役割は主に以下のように分けられる。
        -   Utility(GameFlowMonitor.ts)
            - StateのPhaseとActionと手持ちの動物、コイン、スター、サイコロの目等、の内容をチェックして
                ゲーム内で、プレイヤーが行うことができる動作かをチェックする。ゲームの状況を管理する。（チート対策のため）
    					- Phaseやターンを進める。
    					- 勝利/敗北を判定する。
        -   Service
            -   ゲームのサービスを提供する。
                - ゲーム上で行えるstateの変更、処理そのものが実装されている。
    							- 動物の効果発動もこの領域で行う
    					- Stateの返却を行う
    						- Service上で変更したstateの値を返却する。

# ゲーム全体の流れ

1. frontend で 操作が行われる
2. backendのソケットポイントを実行
3. データをUtilityでチェックする
4. ServiceでStateを修正する。
5. Serviceでデータを返却する。
6. frontendで5.の処理の変更を受け取り、stateに反映する
7. 6の変更をuseEffectで検知してgameStateに反映させる。

---

-   colorは動物の色を表します。
    Cageには規則があります。Cage内に最初に設置された動物(例えば、cage5ならcage5[0]など）の色を持つ動物しか、2体目以降は、配置できないというルールがあります。1体目の色と同じ色を持つ動物しか配置できません。

Webアプリ開発の専門家として回答してください。

これから難易度の高い実装を行うので、複数回に分けて結果を出力してもよい。
動物の効果処理という機能を実装します。

# 動物の効果処理

1. 各プレイヤーがサイコロを振ったとき、それぞれのプレイヤーのBoard内にある、
   サイコロの値と同じ番号のCageの中身を確認します。

2. そのプレイヤーのCage内にいるAnimalの値を確認します。
   ※それぞれAnimalには様々なプロパティがあります。backendのsrc/types/Animalフォルダ内のtsにそれぞれのAnimalのプロパティが設定されています。

3. 例えばプレイヤー2がサイコロをプレイし、5の目が出るとします。
   そうした場合、プレイヤー全員のBoardのcage5の値を取得します。

4. cage5に入っている動物の効果を処理します。効果処理は、プレイヤーのコインやインベントリアイテムを増減させます。

5. 4の手順で行った効果処理をgameStateに反映して、frontendに返却します。

# 効果処理の仕様

全てのプレイヤーBoard内のAnimalを、プレイヤーごとに確認します。
全てのAnimalのEffect内のtimingとglobalプロパティを順に確認します。

-   globalがtrueの場合は「自分以外のプレイヤーのサイコロでも効果が発動」します

-   timingがfirstの場合:サイコロを振った次のプレイヤーから順に処理を行います。最後に自分の動物の効果を処理するようにします。
-   endの場合は、上記に記載した、全員の効果処理が終了した後に、効果処理を行います。

さらに、ほかの項目も確認します。

creationプロパティは、指定された枚数の、コインをプレイヤー付与します。
globalが付いていないとほかのプレイヤーのサイコロの値では発動しないことに注意して下さい。

creationIFは、下記の例のように、条件式を配列で持っています。
例：creationIf: ["Penguin", ">=", "2", "?", "2", ":", "1"],
→自分のBoardのペンギンが2匹以上なら、2Coinを生成する。1体の場合、1Coinを生成する
buffは自身のBoardの動物の数を条件に、コインをプレイヤーに付与します。
例：buff: [1, "RessaPanda", "each"], //自分のレッサーパンダの数だけ、自分のCoinを+1する eachは自分が所有する、第2引数の動物の数だけ、第1引数のコインを生み出します。
bonusbuffは、ほかの効果に加えて、コインを生み出します。

例： bonusbuff: [1, "GiantPanda", "once"], //ほかの効果に加えて、自分のBoardにジャイアントパンダがいる場合、+1Coinする
ここでのonceプロパティは動物の数×コインではなく、「1回だけ、第一引数の数のコインを生成する」効果になります。

stealはほかのプレイヤーのコインを奪います。
例：steal: [5, "target", 1], // 自分以外のプレイヤー1人指定をして5枚のコインを奪います。

choiceは高価を選択して実行します。
例：choice: ["creation", "steal"], // どちらかを選択、 7枚のコインを取得するか、特定のプレイヤーを指定して5枚のコインを奪うかを選択します。

# 実装してほしいこと

この効果処理を行うclassをbackend側で作成してほしいです。
サイコロを実行した後に GameService.tsの// ここで動物の効果を処理します（後で実装）の箇所で呼び出せるようにしてほしいです。

GameState.playersを渡して、全員のBoardのAnimalを確認します。
